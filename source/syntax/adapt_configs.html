

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Adapt configs &mdash; bake  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/logo_tiny_32.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Auto-adjustment of paths to existing projects" href="auto_adjustment.html" />
    <link rel="prev" title="Derive configs" href="derive_configs.html" />
    <link href="../../_static/rtd_theme_overrides.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> bake
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Start to bake</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../why_bake/why_bake.html">Why you should use bake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_bake.html">Install bake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/concepts.html">Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="syntax.html">Syntax</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="project_meta_syntax.html">The Syntax of the Project.meta file</a></li>
<li class="toctree-l2"><a class="reference internal" href="variable_substitutions.html">Variables in Project.meta</a></li>
<li class="toctree-l2"><a class="reference internal" href="derive_configs.html">Derive configs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adapt configs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#from-command-line">From command line</a></li>
<li class="toctree-l3"><a class="reference internal" href="#from-project-meta">From Project.meta</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conditions-and-effectiveness">Conditions and effectiveness</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#condition">Condition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#effectiveness">Effectiveness</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#config-type">Config type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#occurrences">Occurrences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#apply-order">Apply order</a></li>
<li class="toctree-l3"><a class="reference internal" href="#types">Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#type-extend">Type: extend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#type-push-front">Type: push_front</a></li>
<li class="toctree-l4"><a class="reference internal" href="#type-remove">Type: remove</a></li>
<li class="toctree-l4"><a class="reference internal" href="#type-replace">Type: replace</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wildcards">Wildcards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lists">Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-filter">Command line filter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auto_adjustment.html">Auto-adjustment of paths to existing projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="prefix.html">Prefix compiler, archiver and linker</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment.html">Compiler settings via environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commandline/commandline.html">Commandline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/ide_integrations.html">IDE Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_and_tricks/tips_and_tricks.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known_issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../internal/internal.html">Internal developing notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bake</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="syntax.html">Syntax</a> &raquo;</li>
        
      <li>Adapt configs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/source/syntax/adapt_configs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adapt-configs">
<span id="adapt-reference"></span><h1>Adapt configs<a class="headerlink" href="#adapt-configs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>There are two major use cases:</p>
<ul class="simple">
<li><p>Changing the configs from outside, e.g. injecting a toolchain.</p></li>
<li><p>Changing the configs depending on variables like the operating system.</p></li>
</ul>
<p>Both is possible with the <em>Adapt</em> feature.</p>
</div>
<div class="section" id="from-command-line">
<h2>From command line<a class="headerlink" href="#from-command-line" title="Permalink to this headline">¶</a></h2>
<p>If you want to manipulate existing configs without changing them, you can “adapt” them via command line.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">User@Host:~$ </span>bake <span class="nb">test</span> --adapt abc/def
</pre></div>
</div>
<p>bake searches for <em>abc/def</em> in this priority:</p>
<ul class="simple">
<li><p><em>&lt;current directory&gt;/abc/def</em></p></li>
<li><p><em>&lt;main project directory&gt;/abc/def</em></p></li>
<li><p><em>&lt;workspace root&gt;/abc/def</em> (done for all roots)</p></li>
<li><p><em>abc/def/Adapt.meta</em> recursively in all workspace roots (note, that <em>/Adapt.meta</em> is automatically appended here)</p></li>
</ul>
<p>If found, the configs from the adapt file are parsed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt {
  ExecutableConfig ... # 0..n
  LibraryConfig ... # 0..n
  CustomConfig ... # 0..n
}
</pre></div>
</div>
<p>Here is an example to change the DefaultToolchain (details explained below):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt {
  ExecutableConfig test, project: __MAIN__, type: replace {
    DefaultToolchain GCC
  }
}
</pre></div>
</div>
<p>–adapt can be used multiple times:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">User@Host:~$ </span>bake <span class="nb">test</span> --adapt abc --adapt xy
</pre></div>
</div>
<p>The values for adapt can be also comma separated:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">User@Host:~$ </span>bake <span class="nb">test</span> --adapt abc,xy
</pre></div>
</div>
</div>
<div class="section" id="from-project-meta">
<h2>From Project.meta<a class="headerlink" href="#from-project-meta" title="Permalink to this headline">¶</a></h2>
<p>You can do the same within the Project.meta:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Project {
  ...
}
Adapt {
  ...
}
Adapt {
  ...
}
</pre></div>
</div>
</div>
<div class="section" id="conditions-and-effectiveness">
<h2>Conditions and effectiveness<a class="headerlink" href="#conditions-and-effectiveness" title="Permalink to this headline">¶</a></h2>
<p>Be aware, these are two different things but look very similar.</p>
<div class="section" id="condition">
<h3>Condition<a class="headerlink" href="#condition" title="Permalink to this headline">¶</a></h3>
<p>An <em>Adapt</em> can have up to four attributes:</p>
<ul class="simple">
<li><p><strong>toolchain</strong>: e.g. GCC</p></li>
<li><p><strong>os</strong>: can be Windows, Mac, Linux, Unix (which is != Linux)</p></li>
<li><p><strong>mainConfig</strong>: name of the main config</p></li>
<li><p><strong>mainProject</strong>: name of the main project</p></li>
</ul>
<p>User defined conditions are specified in <strong>Scopes</strong>.</p>
<p>The <em>Adapt</em> configs will be only applied if all these conditions are true (“AND” operation). Example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt toolchain: GCC, os: Windows {
  Scope target, value: powerPC
  Scope somethingElse, value: &quot;option1;option2&quot;
  ...
}
</pre></div>
</div>
<p>Here the <em>Adapt</em> configs will be applied if toolchain is GCC on Windows and if target is powerPc and somethingElse either option1 or option2.</p>
<p>User defined scopes must be also specified <strong>in the config to be adapted</strong> or in <strong>main config</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>LibraryConfig Lib {
  Scope target, value: powerPC
  Files &quot;*.cpp&quot;
  ...
}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can write “If” instead of “Adapt”:</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>If toolchain: GCC, os: Windows {
  ...
}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to negate the conditions with “Unless”:</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Unless toolchain: GCC, os: Windows {
  ...
}
</pre></div>
</div>
<p>The adapt block in the example above will be applied if the toolchain is not GCC AND if the OS is not Windows, e.g. for GCC on Linux or Diab Compiler on Mac.</p>
</div>
<div class="section" id="effectiveness">
<h3>Effectiveness<a class="headerlink" href="#effectiveness" title="Permalink to this headline">¶</a></h3>
<p>The <em>Adapt</em> configs can be applied to all configs from regular build. This can be controlled by the config names and the project attributes.
Remember the example from the beginning?</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt {
  ExecutableConfig test, project: __MAIN__, type: replace {
    DefaultToolchain GCC
  }
}
</pre></div>
</div>
<p>This config is applied only to the config “test” of the main project.</p>
<p>__MAIN__, __ALL__ and __THIS__ are keywords:</p>
<ul class="simple">
<li><p><strong>__MAIN__</strong> means the main project or main config</p></li>
<li><p><strong>__ALL__</strong> means all projects or configs</p></li>
<li><p><strong>__THIS__</strong> is only valid for project name, which can be used for <em>Adapts</em> within a Project.meta to restrict the adaption to the current project. This is the default for <em>Adapts</em> in Project.meta.</p></li>
</ul>
<p>If you want to apply the changes only to the top level config, write:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ExecutableConfig __MAIN__, project: __MAIN__, ...
</pre></div>
</div>
<p>If you want to apply the changes to all configs, write:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ExecutableConfig __ALL__, project: __ALL__, ...
</pre></div>
</div>
<p>It is possible to mix the keywords with reals project or config names.</p>
</div>
</div>
<div class="section" id="config-type">
<h2>Config type<a class="headerlink" href="#config-type" title="Permalink to this headline">¶</a></h2>
<p>In most cases the type of the config does not matter. To adapt an attribute or element, the only important thing is that it’s valid in the config of the project AND in the config of the adapt file.</p>
<p>E.g. to adapt a Dependency, the config type is not relevant, Dependency is valid in both cases.</p>
<p>To adapt the ArtifactName, which is exclusively useable in ExecutableConfigs, you need in both cases an ExecutableConfig.</p>
<p>If you want to match the <em>Adapt</em> ONLY for the config type specified in the adapt file, use the strict attribute:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt {
  ExecutableConfig ..., strict: true {
    ...
  }
</pre></div>
</div>
</div>
<div class="section" id="occurrences">
<h2>Occurrences<a class="headerlink" href="#occurrences" title="Permalink to this headline">¶</a></h2>
<p>You can specify more configs in one <em>Adapt</em> and you can specify more than one Adapt.meta file:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt {
  ExecutableConfig ..., project: ..., type: ... {
    ...
  }
  ExecutableConfig ..., project: ..., type: ... {
    ...
  }
  LibraryConfig ..., project: ..., type: ... {
    ...
  }
  ...
}
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">User@Host:~$ </span>bake <span class="nb">test</span> --adapt abc --adapt xy
</pre></div>
</div>
</div>
<div class="section" id="apply-order">
<h2>Apply order<a class="headerlink" href="#apply-order" title="Permalink to this headline">¶</a></h2>
<p>The <em>Adapt</em> configs will be applied in the order in which they were parsed. First the Adapt.metas referenced from the command line are read. Then the Project.metas are read
one by one as usual. If an <em>Adapt</em> is found, it will be appended to the list of <em>Adapts</em>. Note, <em>Adapts</em> will be applied immediately when a Project.meta is read.</p>
<p>If you inject a Toolchain from outside, e.g. “–adapt gcc”, you can use the toolchain info for local <em>Adapts</em>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Project {
  ...
}
Adapt toolchain: GCC {
  ...
}
</pre></div>
</div>
</div>
<div class="section" id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<p>It is possible to specify the type of adaption:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ExecutableConfig ..., type: replace
</pre></div>
</div>
<p>The type can be</p>
<ul class="simple">
<li><p><strong>replace</strong></p></li>
<li><p><strong>remove</strong></p></li>
<li><p><strong>extend</strong></p></li>
<li><p><strong>push_front</strong></p></li>
</ul>
<div class="section" id="type-extend">
<h3>Type: extend<a class="headerlink" href="#type-extend" title="Permalink to this headline">¶</a></h3>
<p>This works exactly like for <a class="reference internal" href="derive_configs.html"><span class="doc">Derive configs</span></a>.</p>
</div>
<div class="section" id="type-push-front">
<h3>Type: push_front<a class="headerlink" href="#type-push-front" title="Permalink to this headline">¶</a></h3>
<p>This works like extend, but elements which can be contained multiple times are pushed to front.</p>
<p>Example project config:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Project {
  LibraryConfig test {
    IncludeDir &quot;abc&quot;
    ...
  }
}

Adapt ... {
  LibraryConfig test, project: __THIS__, type: push_front {
    IncludeDir &quot;mock&quot;
  }
}
</pre></div>
</div>
<p>The resulting include path order will be “-Imock -Iabc”.</p>
</div>
<div class="section" id="type-remove">
<h3>Type: remove<a class="headerlink" href="#type-remove" title="Permalink to this headline">¶</a></h3>
<p>If parent elements can be found which matches to the child elements, they will be removed.</p>
<p>Example project config:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ExecutableConfig test {
  DefaultToolchain GCC
}
</pre></div>
</div>
<p>Example <em>Adapt</em> configs:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ExecutableConfig __ALL__, project: __ALL__, type: remove {
  DefaultToolchain # remove ok
}

ExecutableConfig __ALL__, project: __ALL__, type: remove {
  DefaultToolchain GCC # remove ok
}

ExecutableConfig __ALL__, project: __ALL__, type: remove {
  DefaultToolchain Diab # remove NOT ok
}

ExecutableConfig __ALL__, project: __ALL__, type: remove {
  DefaultToolchain GCC, eclipseOrder: true # remove NOT ok
}
</pre></div>
</div>
</div>
<div class="section" id="type-replace">
<h3>Type: replace<a class="headerlink" href="#type-replace" title="Permalink to this headline">¶</a></h3>
<p>This is for convenience. “replace” will remove all elements with the same type and extends the configs.</p>
<p>Example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ExecutableConfig __ALL__, project: __ALL__, type: replace {
  Files &quot;*.cpp&quot;
  DefaultToolchain GCC {
    Linker command: &quot;link.exe&quot;
  }
}
</pre></div>
</div>
<p>This removes all “Files” and the “DefaultToolchain” from the original config regardless their attributes and replaces them by the elements of the <em>Adapt</em> config.</p>
</div>
</div>
<div class="section" id="wildcards">
<h2>Wildcards<a class="headerlink" href="#wildcards" title="Permalink to this headline">¶</a></h2>
<p>The “*” wildcard is allowed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt mainProject: HERE, mainConfig: HERE ... {
  Scope fasel, value: HERE
  SomeConfig HERE, project: HERE ... {
    ....
  }
}
</pre></div>
</div>
<p>Example (the configs of the Adapt are applied if the main config name starts with “UnitTest”):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt mainConfig: &quot;UnitTest*&quot; {
  ...
}
</pre></div>
</div>
</div>
<div class="section" id="lists">
<h2>Lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h2>
<p>Additionally to the wildcards, a list of projects/configs can be specified separated with “;”.</p>
<p>Example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Adapt mainProject: &quot;projA;projB&quot;, mainConfig: &quot;UnitTest*;SomeOther&quot; ... {
  Scope fasel, value: &quot;option*;fasel&quot;
  SomeConfig &quot;libA;libX*&quot;, project: &quot;can*;*lin&quot; ... {
    ....
  }
}
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>LibraryConfig Lib {
  Scope target, value: &quot;z4a;z4b&quot;
    ....
  }
}
</pre></div>
</div>
</div>
<div class="section" id="command-line-filter">
<h2>Command line filter<a class="headerlink" href="#command-line-filter" title="Permalink to this headline">¶</a></h2>
<p>To apply adapt files to specific projects only, the usage can be restricted with square brackets:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--adapt abc[libraryA;libraryB]
</pre></div>
</div>
<p>In this case the Adapt.meta in abc is applied to libraryA and libraryB only. Note that further restrictions in the adapt file are still effective.</p>
<p>Lists and wildcards can be used as described above, e.g.:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--adapt abc[__MAIN__;*driver],xy/Adapt.meta[*can*;*lin*]
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="auto_adjustment.html" class="btn btn-neutral float-right" title="Auto-adjustment of paths to existing projects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="derive_configs.html" class="btn btn-neutral float-left" title="Derive configs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2012-2021, ESRLabs GmbH.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>